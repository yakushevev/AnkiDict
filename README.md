# Генератор словарей Anki из CSV

Проект для генерации словарей в формате `.apkg` для Anki из двух CSV файлов с поддержкой TTS озвучки.

**GitHub**: https://github.com/yakushevev/AnkiDict

## Установка

1. Установите зависимости:
```bash
pip install -r requirements.txt
```

## Использование

```bash
python main.py <csv1> <csv2> [опции]
```

### Параметры

- `csv1` - Путь к первому CSV файлу (слова и иероглифы)
- `csv2` - Путь ко второму CSV файлу (переводы)
- `-o, --output` - Имя выходного файла .apkg (по умолчанию: `chinese_dict.apkg`)
- `-d, --deck-name` - Название колоды Anki (по умолчанию: `Chinese Dictionary`)
- `--audio-dir` - Директория для кэширования аудио файлов (по умолчанию: `audio_cache`)

### Пример

```bash
python main.py words.csv translations.csv -o my_dict.apkg -d "Мой словарь"
```

## Формат CSV файлов

Проект автоматически определяет разделитель CSV файлов (точка с запятой `;` или запятая `,`).

### Первый CSV файл (слова и иероглифы)

Формат строки:
```
первая_буква;произношение;иероглиф1;иероглиф2;...;иероглиф9;слова1;слова2;...;слова5
```

**Важно:** Все иероглифы в одной строке (колонки 2-10) считаются омофонами друг друга, так как они имеют одинаковое произношение.

Пример:
```
s;shí;时;食;十;实;;;;;;十, 时间, 零食, 食物, 食堂, 时间;;;什么时候, 平时, 的时候, 有时候;
s;shì;是;室;市;视;试;世;柿;事;氏;卧室, 超市, 办公室, 电视, 室友, 西红柿, 考试, 试衣间, 城市, 会议室, 同事, 姓氏, 故事, 电视剧, 市中心, 我也是, 没事把;有事儿;是;可是, 当是;还是
```

### Второй CSV файл (переводы)

Формат строки:
```
слово;произношение;перевод
```

**Важно:** Произношение из второго CSV файла имеет приоритет над произношением из первого CSV, так как здесь указано произношение всего слова, а не отдельных иероглифов.

Перевод должен быть в формате: `тип1: значение1, значение2 | тип2: значение3`

Пример:
```
会;huì;глаг.: уметь, мочь | сущ.: собрание
分钟;fēnzhōng;сущ.: минута
```

## Формат карточек

### Лицевая сторона
- Крупно по центру: слово
- Снизу: **произношение всего слова** (из второго CSV файла)
- Автоматическая озвучка слова

### Оборотная сторона
1. **Перевод слова** - многоуровневый список по типам (глагол, наречие, прилагательное и т.д.)
2. **Разбор иероглифов** - для **каждого иероглифа** в слове:
   - Слова через запятую с таким же иероглифом в составе
   - **Омофоны** - иероглифы с идентичным звучанием (определяются из строк первого CSV, где этот иероглиф присутствует в списке омофонов)

## Особенности

- **Автоматическое определение разделителя CSV** - поддерживает как точку с запятой, так и запятую
- **Автоматическое удаление дубликатов слов** - каждое слово встречается только один раз
- **Умная обработка многосоставных слов** - слова, встречающиеся в нескольких строках, правильно связываются со всеми своими иероглифами
- **Правильное произношение** - используется произношение всего слова из второго CSV, а не отдельных иероглифов
- **Генерация озвучки через Google TTS (gTTS)** - автоматическая озвучка каждого слова
- **Кэширование аудио файлов** - для ускорения повторной генерации
- **Красивое HTML оформление карточек** - современный и читаемый дизайн
- **Умная обработка омофонов** - для каждого иероглифа в слове определяются омофоны из всех строк, где этот иероглиф присутствует
- **Пропуск карточек без переводов** - карточки без переводов автоматически пропускаются с выводом статистики
- **Корректная работа с кодировкой** - правильное отображение русского текста в Windows

## Обработка омофонов

Проект автоматически определяет и отображает омофоны (иероглифы с одинаковым произношением) для **каждого иероглифа в слове**:

1. **Из первого CSV файла**: Все иероглифы, указанные в одной строке (колонки 2-10), автоматически считаются омофонами друг друга, так как они имеют одинаковое произношение в этой строке.

   Например, в строке `z;zhōng;中;钟;终` иероглифы 中, 钟, 终 являются омофонами (все произносятся как "zhōng").

2. **Для каждого иероглифа в слове**: Омофоны определяются из всех строк первого CSV, где этот иероглиф присутствует в списке омофонов. Это означает, что если слово содержит несколько иероглифов, для каждого из них будут показаны свои омофоны.

   Например, для слова "分钟" (分 + 钟):
   - Для иероглифа "分": омофонов нет (в строке с "fēn" только один иероглиф)
   - Для иероглифа "钟": омофоны "中, 终" (из строки с "zhōng")

3. **На карточке**: Для каждого иероглифа в слове отображается список всех омофонов (иероглифов с таким же звучанием), что помогает лучше запоминать и различать похожие по звучанию иероглифы.

Это особенно полезно при изучении китайского языка, где многие иероглифы имеют одинаковое произношение, но разное написание и значение.

## Структура проекта

```
ankiDict/
├── main.py              # Основной скрипт
├── csv_parser.py        # Парсер CSV файлов
├── anki_generator.py    # Генератор карточек Anki
├── tts_handler.py       # Обработчик TTS
├── requirements.txt     # Зависимости
└── README.md           # Документация
```

## Зависимости

- `genanki` - для генерации .apkg файлов
- `gtts` - для генерации озвучки
- `pydub` - для работы с аудио (опционально)

## Примечания

- Для работы TTS требуется подключение к интернету
- Аудио файлы кэшируются в директории `audio_cache` для ускорения повторной генерации
- Слова автоматически дедуплицируются при парсинге
- Карточки без переводов автоматически пропускаются (в конце генерации выводится статистика пропущенных карточек)
- Проект корректно работает в Windows с правильным отображением русского текста
- Поддерживаются CSV файлы с разделителем как точка с запятой (`;`), так и запятая (`,`)